# 📜 Gemini Counter Pro - Changelog

### 📦 v5.x Series: The Ultimate Edition (企业级/多用户/主题)
*这一阶段不仅完善了功能，更是在与 Google 严格的 CSP 安全策略博弈中取得了最终胜利。*

#### **v5.3 (Latest Stable)**
> *原 V17 - 2023/xx/xx*
- **⚡ 核心重构**: 彻底弃用 `innerHTML` 清空容器，改用原生 `replaceChildren()`，根除所有潜在的 TrustedHTML 报错。
- **🧠 智能逻辑**: 优化“新对话”判定逻辑。采用 **智能轮询机制 (Smart Polling)**，在 10秒内持续检测 URL 变化，确保即使网络延迟也能精准捕获新 Chat ID 并归档计数，彻底解决新窗口计数丢失问题。
- **💾 数据持久化**: 修复了 Session 计数在页面刷新后丢失的问题，现在 Session 数据会写入本地存储。
- **🔄 实时同步**: 重新引入多标签页同步机制，当在一个窗口操作时，其他窗口的 UI 会实时更新。
- **✅ 修复**: 修复了详情面板在展开/切换视图时的渲染 Bug。

#### **v5.2**
> *原 V16 - 2023/xx/xx*
- **🛡️ 容错机制**: 引入身份识别超时降级策略。如果 2秒内未提取到邮箱，自动降级为 `Local_User`，防止面板卡在 "Initializing..."。
- **🔍 识别增强**: 增加了对中文环境（"帐号"）和 Google 通用顶部栏的 DOM 识别规则。

#### **v5.1**
> *原 V15 - 2023/xx/xx*
- **🎨 新增功能**: 引入 **Theme Engine (主题引擎)**，支持 Glass (默认)、Cyber (赛博朋克)、Paper (白纸) 三种风格。
- **👥 新增功能**: 引入 **Profiles (用户画像)** 列表，支持跨账户查看数据（View Only 模式）。
- **🐛 修复**: 修复了新开 Chat 时 URL 未变化导致计数错误归类的问题。
- **📝 记录**: *[Build v14 被撤回]* 因在构建用户列表时使用了模板字符串导致 CSP 崩溃，v5.1 全面改回纯 DOM 构建。

#### **v5.0**
> *原 V13 - 2023/xx/xx*
- **🚀 重大更新**: 实现了 **Multi-User Support (多用户隔离)**。
- **⚙️ 技术细节**: 自动提取 Google 账号邮箱作为主键，不同账号的数据完全隔离，互不干扰。
- **📦 数据迁移**: 首次运行时自动将旧版本的单机数据迁移至当前登录账号。

---

### 🌿 Alternative Branch: Simple Sync (简约同步版)
#### **v6.0 (Legacy Sync)**
> *对应文件: GeminiCounter_Simple.user.js*
- **定位**: v2.x 系列的最终形态，Gemini Counter Pro 的直系后代。
- **特性**: 保留了 v2.x 的单计数器逻辑，但引入了 v5.x 级别的 UI 和 v2.1 的同步核心。
- **状态**: 已归档。适合不需要仪表盘、只想要一个简单计数器的用户。

---

### 📦 v4.x Series: Compatibility (兼容性更新)

#### **v4.0**
> *原 V12 - 2023/xx/xx*
- **🛡️ 防冲突**: 为面板添加 `translate="no"` 和 `class="notranslate"` 属性。
- **🔧 解决痛点**: 完美解决了与“沉浸式翻译”等插件同时使用时，因 DOM 被强行翻译修改而导致的脚本崩溃问题。

---

### 📦 v3.x Series: Dashboard (仪表盘与统计)

#### **v3.1**
> *原 V11 - 2023/xx/xx*
- **📊 交互升级**: 引入 **Dashboard View (仪表盘视图)**。
- **✨ 特性**: 支持点击列表行切换主视图（Session / Chat / Lifetime），按钮功能随上下文自动变化（重置当前/重置历史）。

#### **v3.0**
> *原 V10 - 2023/xx/xx*
- **📈 重大更新**: 新增 **Expandable Details (折叠详情页)**，支持查看当前窗口计数与历史总计。
- **🔒 安全重置**: 引入“三级确认锁”机制（Sure? -> Really?），防止误删历史数据。
- **📝 记录**: *[Build v9 被撤回]* 因在详情页使用了 `innerHTML` 触发 TrustedHTML 报错，v3.0 进行了纯 DOM 重写。

---

### 📦 v2.x Series: GUI & Sync (界面与同步)

#### **v2.3**
> *原 V8 - 2023/xx/xx*
- **🚑 紧急修复**: 修复了 v2.2 中为了加“小绿点” UI 而引入的 CSP 安全报错，回归纯 DOM 操作。

#### **v2.2**
> *原 V7 - 2023/xx/xx*
- **🧱 边界物理**: 引入窗口拖拽的“空气墙”，防止面板被拖出屏幕可视区域。
- **🆘 救援功能**: 在油猴菜单中新增 "Reset Position"，用于在窗口位置异常时一键复位。

#### **v2.1**
> *原 V6 - 2023/xx/xx*
- **🔄 核心升级**: 引入 `GM_addValueChangeListener`。
- **✅ 解决痛点**: 解决了多标签页（Tab A / Tab B）同时使用时数据不同步、相互覆盖的竞态条件问题。

#### **v2.0**
> *原 V5 - 2023/xx/xx*
- **🎨 UI 重构**: 从简单的文本框升级为 **Glassmorphism (磨砂玻璃)** 悬浮窗。
- **🖐️ 交互**: 支持自由拖拽与位置记忆。

---

### 📦 v1.x Series: Core Foundation (核心功能)

#### **v1.1**
> *原 V4 - 2023/xx/xx*
- **⌨️ 体验优化**: 引入输入法状态检测 (`isComposing`)。
- **✅ 解决痛点**: 修复了中文输入法按回车选词时会被误判为发送消息的 Bug。

#### **v1.0**
> *原 V1-V3 整合*
- **🚀 初始发布**: 基于原生 DOM API 的计数器。
- **⚙️ 核心技术**: 绕过 `innerHTML` 限制，利用 `Observer` 监听 SPA 页面变化，实现基础计数功能。
